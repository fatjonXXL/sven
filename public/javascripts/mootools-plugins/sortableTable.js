var sortableTable=new Class({getOptions:function(){return{overCls:false,onClick:false,sortOn:0,sortBy:"ASC",filterHide:true,filterHideCls:"hide",filterSelectedCls:"selected"}},initialize:function(b,a){this.setOptions(this.getOptions(),a);this.table=$(b);this.tHead=this.table.getElement("thead");this.tBody=this.table.getElement("tbody");this.tFoot=this.table.getElement("tfoot");this.elements=this.tBody.getElements("tr");this.filtered=false;this.elements.each(function(d,c){if(this.options.overCls){d.addEvent("mouseover",function(){d.addClass(a.overCls)},this);d.addEvent("mouseout",function(){d.removeClass(a.overCls)})}if(this.options.onClick){d.addEvent("click",a.onClick)}},this);this.tHead.getElements("th").each(function(d,c){if(d.axis){d.addEvent("click",this.sort.bind(this,c));d.addEvent("mouseover",function(){d.addClass("tableHeaderOver")});d.addEvent("mouseout",function(){d.removeClass("tableHeaderOver")});d.getdate=function(g){function f(h){h=+h;if(h<50){h+=2000}else{if(h<100){h+=1900}}return h}var e;if(g.length>12){strtime=g.substring(g.lastIndexOf(" ")+1);strtime=strtime.substring(0,2)+strtime.substr(-2)}else{strtime="0000"}if(e=g.match(/(\d{2,4})-(\d{1,2})-(\d{1,2})/)){return(f(e[1])*10000)+(e[2]*100)+(+e[3])+strtime}if(e=g.match(/(\d{1,2})[\/-](\d{1,2})[\/-](\d{2,4})/)){return(f(e[3])*10000)+(e[2]*100)+(+e[1])+strtime}return 999999990000};d.findData=function(e){var f=e.getFirst();if(f){return d.findData(f)}else{return e.innerHTML.trim()}};d.compare=function(f,e){var1=d.findData(f.getChildren()[c]);var2=d.findData(e.getChildren()[c]);if(d.axis=="number"){var1=parseFloat(var1);var2=parseFloat(var2);if(d.sortBy=="ASC"){return var1-var2}else{return var2-var1}}else{if(d.axis=="string"){var1=var1.toUpperCase();var2=var2.toUpperCase();if(var1==var2){return 0}if(d.sortBy=="ASC"){if(var1<var2){return -1}}else{if(var1>var2){return -1}}return 1}else{if(d.axis=="date"){var1=parseFloat(d.getdate(var1));var2=parseFloat(d.getdate(var2));if(d.sortBy=="ASC"){return var1-var2}else{return var2-var1}}else{if(d.axis=="currency"){var1=parseFloat(var1.substr(1).replace(",",""));var2=parseFloat(var2.substr(1).replace(",",""));if(d.sortBy=="ASC"){return var1-var2}else{return var2-var1}}}}}};if(c==this.options.sortOn){d.fireEvent("click")}}},this)},sort:function(a){if(this.options.onStart){this.fireEvent("onStart")}this.options.sortOn=a;var c=this.tHead.getElements("th");var b=c[a];c.each(function(f,d){if(d!=a){f.removeClass("sortedASC");f.removeClass("sortedDESC")}});if(b.hasClass("sortedASC")){b.removeClass("sortedASC");b.addClass("sortedDESC");b.sortBy="DESC"}else{if(b.hasClass("sortedDESC")){b.removeClass("sortedDESC");b.addClass("sortedASC");b.sortBy="ASC"}else{if(this.options.sortBy=="ASC"){b.addClass("sortedASC");b.sortBy="ASC"}else{if(this.options.sortBy=="DESC"){b.addClass("sortedDESC");b.sortBy="DESC"}}}}this.elements.sort(b.compare);this.elements.injectInside(this.tBody);if(this.filtered){this.filteredAltRow()}else{this.altRow()}if(this.options.onComplete){this.fireEvent("onComplete")}},altRow:function(){this.elements.each(function(b,a){if(a%2){b.removeClass("altRow")}else{b.addClass("altRow")}})},filteredAltRow:function(){this.table.getElements("."+this.options.filterSelectedCls).each(function(b,a){if(a%2){b.removeClass("altRow")}else{b.addClass("altRow")}})},filter:function(c){var c=$(c);var a=0;var b="";c.getChildren().each(function(e,d){if(e.id=="column"){a=Number(e.value)}if(e.id=="keyword"){b=e.value.toLowerCase()}if(e.type=="reset"){e.addEvent("click",this.clearFilter.bind(this))}},this);if(b){this.elements.each(function(e,d){if(this.options.filterHide){e.removeClass("altRow")}if(e.getChildren()[a].firstChild.data.toLowerCase().indexOf(b)>-1){e.addClass(this.options.filterSelectedCls);if(this.options.filterHide){e.removeClass(this.options.filterHideCls)}}else{e.removeClass(this.options.filterSelectedCls);if(this.options.filterHide){e.addClass(this.options.filterHideCls)}}},this);if(this.options.filterHide){this.filteredAltRow();this.filtered=true}}},clearFilter:function(){this.elements.each(function(b,a){b.removeClass(this.options.filterSelectedCls);if(this.options.filterHide){b.removeClass(this.options.filterHideCls)}},this);if(this.options.filterHide){this.altRow();this.filtered=false}}});sortableTable.implement(new Events);sortableTable.implement(new Options);